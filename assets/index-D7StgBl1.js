(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function _(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=_(o);fetch(o.href,n)}})();var q,m,de,L,_e,me,ye,ve,X,V,Y,D={},ge=[],Te=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,J=Array.isArray;function E(t,e){for(var _ in e)t[_]=e[_];return t}function Z(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ce(t,e,_){var r,o,n,l={};for(n in e)n=="key"?r=e[n]:n=="ref"?o=e[n]:l[n]=e[n];if(arguments.length>2&&(l.children=arguments.length>3?q.call(arguments,2):_),typeof t=="function"&&t.defaultProps!=null)for(n in t.defaultProps)l[n]===void 0&&(l[n]=t.defaultProps[n]);return F(t,l,r,o,null)}function F(t,e,_,r,o){var n={type:t,props:e,key:_,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++de,__i:-1,__u:0};return o==null&&m.vnode!=null&&m.vnode(n),n}function z(t){return t.children}function W(t,e){this.props=t,this.context=e}function A(t,e){if(e==null)return t.__?A(t.__,t.__i+1):null;for(var _;e<t.__k.length;e++)if((_=t.__k[e])!=null&&_.__e!=null)return _.__e;return typeof t.type=="function"?A(t):null}function be(t){var e,_;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((_=t.__k[e])!=null&&_.__e!=null){t.__e=t.__c.base=_.__e;break}return be(t)}}function ne(t){(!t.__d&&(t.__d=!0)&&L.push(t)&&!R.__r++||_e!=m.debounceRendering)&&((_e=m.debounceRendering)||me)(R)}function R(){for(var t,e,_,r,o,n,l,s=1;L.length;)L.length>s&&L.sort(ye),t=L.shift(),s=L.length,t.__d&&(_=void 0,o=(r=(e=t).__v).__e,n=[],l=[],e.__P&&((_=E({},r)).__v=r.__v+1,m.vnode&&m.vnode(_),ee(e.__P,_,r,e.__n,e.__P.namespaceURI,32&r.__u?[o]:null,n,o??A(r),!!(32&r.__u),l),_.__v=r.__v,_.__.__k[_.__i]=_,we(n,_,l),_.__e!=o&&be(_)));R.__r=0}function xe(t,e,_,r,o,n,l,s,u,c,p){var i,a,f,y,w,g,d=r&&r.__k||ge,h=e.length;for(u=He(_,e,d,u,h),i=0;i<h;i++)(f=_.__k[i])!=null&&(a=f.__i==-1?D:d[f.__i]||D,f.__i=i,g=ee(t,f,a,o,n,l,s,u,c,p),y=f.__e,f.ref&&a.ref!=f.ref&&(a.ref&&te(a.ref,null,f),p.push(f.ref,f.__c||y,f)),w==null&&y!=null&&(w=y),4&f.__u||a.__k===f.__k?u=ke(f,u,t):typeof f.type=="function"&&g!==void 0?u=g:y&&(u=y.nextSibling),f.__u&=-7);return _.__e=w,u}function He(t,e,_,r,o){var n,l,s,u,c,p=_.length,i=p,a=0;for(t.__k=new Array(o),n=0;n<o;n++)(l=e[n])!=null&&typeof l!="boolean"&&typeof l!="function"?(u=n+a,(l=t.__k[n]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?F(null,l,null,null,null):J(l)?F(z,{children:l},null,null,null):l.constructor==null&&l.__b>0?F(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=t,l.__b=t.__b+1,s=null,(c=l.__i=Le(l,_,u,i))!=-1&&(i--,(s=_[c])&&(s.__u|=2)),s==null||s.__v==null?(c==-1&&(o>p?a--:o<p&&a++),typeof l.type!="function"&&(l.__u|=4)):c!=u&&(c==u-1?a--:c==u+1?a++:(c>u?a--:a++,l.__u|=4))):t.__k[n]=null;if(i)for(n=0;n<p;n++)(s=_[n])!=null&&(2&s.__u)==0&&(s.__e==r&&(r=A(s)),Ee(s,s));return r}function ke(t,e,_){var r,o;if(typeof t.type=="function"){for(r=t.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=t,e=ke(r[o],e,_));return e}t.__e!=e&&(e&&t.type&&!_.contains(e)&&(e=A(t)),_.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Le(t,e,_,r){var o,n,l=t.key,s=t.type,u=e[_];if(u===null&&t.key==null||u&&l==u.key&&s==u.type&&(2&u.__u)==0)return _;if(r>(u!=null&&(2&u.__u)==0?1:0))for(o=_-1,n=_+1;o>=0||n<e.length;){if(o>=0){if((u=e[o])&&(2&u.__u)==0&&l==u.key&&s==u.type)return o;o--}if(n<e.length){if((u=e[n])&&(2&u.__u)==0&&l==u.key&&s==u.type)return n;n++}}return-1}function re(t,e,_){e[0]=="-"?t.setProperty(e,_??""):t[e]=_==null?"":typeof _!="number"||Te.test(e)?_:_+"px"}function U(t,e,_,r,o){var n,l;e:if(e=="style")if(typeof _=="string")t.style.cssText=_;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)_&&e in _||re(t.style,e,"");if(_)for(e in _)r&&_[e]==r[e]||re(t.style,e,_[e])}else if(e[0]=="o"&&e[1]=="n")n=e!=(e=e.replace(ve,"$1")),l=e.toLowerCase(),e=l in t||e=="onFocusOut"||e=="onFocusIn"?l.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+n]=_,_?r?_.u=r.u:(_.u=X,t.addEventListener(e,n?Y:V,n)):t.removeEventListener(e,n?Y:V,n);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=_??"";break e}catch{}typeof _=="function"||(_==null||_===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&_==1?"":_))}}function oe(t){return function(e){if(this.l){var _=this.l[e.type+t];if(e.t==null)e.t=X++;else if(e.t<_.u)return;return _(m.event?m.event(e):e)}}}function ee(t,e,_,r,o,n,l,s,u,c){var p,i,a,f,y,w,g,d,h,T,S,C,N,I,H,$,P,k=e.type;if(e.constructor!=null)return null;128&_.__u&&(u=!!(32&_.__u),n=[s=e.__e=_.__e]),(p=m.__b)&&p(e);e:if(typeof k=="function")try{if(d=e.props,h="prototype"in k&&k.prototype.render,T=(p=k.contextType)&&r[p.__c],S=p?T?T.props.value:p.__:r,_.__c?g=(i=e.__c=_.__c).__=i.__E:(h?e.__c=i=new k(d,S):(e.__c=i=new W(d,S),i.constructor=k,i.render=Me),T&&T.sub(i),i.props=d,i.state||(i.state={}),i.context=S,i.__n=r,a=i.__d=!0,i.__h=[],i._sb=[]),h&&i.__s==null&&(i.__s=i.state),h&&k.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=E({},i.__s)),E(i.__s,k.getDerivedStateFromProps(d,i.__s))),f=i.props,y=i.state,i.__v=e,a)h&&k.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),h&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(h&&k.getDerivedStateFromProps==null&&d!==f&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(d,S),!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(d,i.__s,S)===!1||e.__v==_.__v){for(e.__v!=_.__v&&(i.props=d,i.state=i.__s,i.__d=!1),e.__e=_.__e,e.__k=_.__k,e.__k.some(function(M){M&&(M.__=e)}),C=0;C<i._sb.length;C++)i.__h.push(i._sb[C]);i._sb=[],i.__h.length&&l.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(d,i.__s,S),h&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(f,y,w)})}if(i.context=S,i.props=d,i.__P=t,i.__e=!1,N=m.__r,I=0,h){for(i.state=i.__s,i.__d=!1,N&&N(e),p=i.render(i.props,i.state,i.context),H=0;H<i._sb.length;H++)i.__h.push(i._sb[H]);i._sb=[]}else do i.__d=!1,N&&N(e),p=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++I<25);i.state=i.__s,i.getChildContext!=null&&(r=E(E({},r),i.getChildContext())),h&&!a&&i.getSnapshotBeforeUpdate!=null&&(w=i.getSnapshotBeforeUpdate(f,y)),$=p,p!=null&&p.type===z&&p.key==null&&($=Se(p.props.children)),s=xe(t,J($)?$:[$],e,_,r,o,n,l,s,u,c),i.base=e.__e,e.__u&=-161,i.__h.length&&l.push(i),g&&(i.__E=i.__=null)}catch(M){if(e.__v=null,u||n!=null)if(M.then){for(e.__u|=u?160:128;s&&s.nodeType==8&&s.nextSibling;)s=s.nextSibling;n[n.indexOf(s)]=null,e.__e=s}else for(P=n.length;P--;)Z(n[P]);else e.__e=_.__e,e.__k=_.__k;m.__e(M,e,_)}else n==null&&e.__v==_.__v?(e.__k=_.__k,e.__e=_.__e):s=e.__e=Ae(_.__e,e,_,r,o,n,l,u,c);return(p=m.diffed)&&p(e),128&e.__u?void 0:s}function we(t,e,_){for(var r=0;r<_.length;r++)te(_[r],_[++r],_[++r]);m.__c&&m.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(n){n.call(o)})}catch(n){m.__e(n,o.__v)}})}function Se(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:J(t)?t.map(Se):E({},t)}function Ae(t,e,_,r,o,n,l,s,u){var c,p,i,a,f,y,w,g=_.props,d=e.props,h=e.type;if(h=="svg"?o="http://www.w3.org/2000/svg":h=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),n!=null){for(c=0;c<n.length;c++)if((f=n[c])&&"setAttribute"in f==!!h&&(h?f.localName==h:f.nodeType==3)){t=f,n[c]=null;break}}if(t==null){if(h==null)return document.createTextNode(d);t=document.createElementNS(o,h,d.is&&d),s&&(m.__m&&m.__m(e,n),s=!1),n=null}if(h==null)g===d||s&&t.data==d||(t.data=d);else{if(n=n&&q.call(t.childNodes),g=_.props||D,!s&&n!=null)for(g={},c=0;c<t.attributes.length;c++)g[(f=t.attributes[c]).name]=f.value;for(c in g)if(f=g[c],c!="children"){if(c=="dangerouslySetInnerHTML")i=f;else if(!(c in d)){if(c=="value"&&"defaultValue"in d||c=="checked"&&"defaultChecked"in d)continue;U(t,c,null,f,o)}}for(c in d)f=d[c],c=="children"?a=f:c=="dangerouslySetInnerHTML"?p=f:c=="value"?y=f:c=="checked"?w=f:s&&typeof f!="function"||g[c]===f||U(t,c,f,g[c],o);if(p)s||i&&(p.__html==i.__html||p.__html==t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(i&&(t.innerHTML=""),xe(e.type=="template"?t.content:t,J(a)?a:[a],e,_,r,h=="foreignObject"?"http://www.w3.org/1999/xhtml":o,n,l,n?n[0]:_.__k&&A(_,0),s,u),n!=null)for(c=n.length;c--;)Z(n[c]);s||(c="value",h=="progress"&&y==null?t.removeAttribute("value"):y!=null&&(y!==t[c]||h=="progress"&&!y||h=="option"&&y!=g[c])&&U(t,c,y,g[c],o),c="checked",w!=null&&w!=t[c]&&U(t,c,w,g[c],o))}return t}function te(t,e,_){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(o){m.__e(o,_)}}function Ee(t,e,_){var r,o;if(m.unmount&&m.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||te(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(n){m.__e(n,e)}r.base=r.__P=null}if(r=t.__k)for(o=0;o<r.length;o++)r[o]&&Ee(r[o],e,_||typeof t.type!="function");_||Z(t.__e),t.__c=t.__=t.__e=void 0}function Me(t,e,_){return this.constructor(t,_)}function Oe(t,e,_){var r,o,n,l;e==document&&(e=document.documentElement),m.__&&m.__(t,e),o=(r=!1)?null:e.__k,n=[],l=[],ee(e,t=e.__k=Ce(z,null,[t]),o||D,D,e.namespaceURI,o?null:e.firstChild?q.call(e.childNodes):null,n,o?o.__e:e.firstChild,r,l),we(n,t,l)}q=ge.slice,m={__e:function(t,e,_,r){for(var o,n,l;e=e.__;)if((o=e.__c)&&!o.__)try{if((n=o.constructor)&&n.getDerivedStateFromError!=null&&(o.setState(n.getDerivedStateFromError(t)),l=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,r||{}),l=o.__d),l)return o.__E=o}catch(s){t=s}throw t}},de=0,W.prototype.setState=function(t,e){var _;_=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=E({},this.state),typeof t=="function"&&(t=t(E({},_),this.props)),t&&E(_,t),t!=null&&this.__v&&(e&&this._sb.push(e),ne(this))},W.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ne(this))},W.prototype.render=z,L=[],me=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ye=function(t,e){return t.__v.__b-e.__v.__b},R.__r=0,ve=/(PointerCapture)$|Capture$/i,X=0,V=oe(!1),Y=oe(!0);var De=0;function b(t,e,_,r,o,n){e||(e={});var l,s,u=e;if("ref"in u)for(s in u={},e)s=="ref"?l=e[s]:u[s]=e[s];var c={type:t,props:u,key:_,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--De,__i:-1,__u:0,__source:o,__self:n};if(typeof t=="function"&&(l=t.defaultProps))for(s in l)u[s]===void 0&&(u[s]=l[s]);return m.vnode&&m.vnode(c),c}var B,v,K,ie,G=0,Ne=[],x=m,le=x.__b,se=x.__r,ce=x.diffed,ae=x.__c,ue=x.unmount,fe=x.__;function $e(t,e){x.__h&&x.__h(v,t,G||e),G=0;var _=v.__H||(v.__H={__:[],__h:[]});return t>=_.__.length&&_.__.push({}),_.__[t]}function O(t){return G=1,Ie(Pe,t)}function Ie(t,e,_){var r=$e(B++,2);if(r.t=t,!r.__c&&(r.__=[Pe(void 0,e),function(s){var u=r.__N?r.__N[0]:r.__[0],c=r.t(u,s);u!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=v,!v.__f)){var o=function(s,u,c){if(!r.__c.__H)return!0;var p=r.__c.__H.__.filter(function(a){return!!a.__c});if(p.every(function(a){return!a.__N}))return!n||n.call(this,s,u,c);var i=r.__c.props!==s;return p.forEach(function(a){if(a.__N){var f=a.__[0];a.__=a.__N,a.__N=void 0,f!==a.__[0]&&(i=!0)}}),n&&n.call(this,s,u,c)||i};v.__f=!0;var n=v.shouldComponentUpdate,l=v.componentWillUpdate;v.componentWillUpdate=function(s,u,c){if(this.__e){var p=n;n=void 0,o(s,u,c),n=p}l&&l.call(this,s,u,c)},v.shouldComponentUpdate=o}return r.__N||r.__}function pe(t,e){var _=$e(B++,3);!x.__s&&We(_.__H,e)&&(_.__=t,_.u=e,v.__H.__h.push(_))}function Ue(){for(var t;t=Ne.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(j),t.__H.__h.forEach(Q),t.__H.__h=[]}catch(e){t.__H.__h=[],x.__e(e,t.__v)}}x.__b=function(t){v=null,le&&le(t)},x.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),fe&&fe(t,e)},x.__r=function(t){se&&se(t),B=0;var e=(v=t.__c).__H;e&&(K===v?(e.__h=[],v.__h=[],e.__.forEach(function(_){_.__N&&(_.__=_.__N),_.u=_.__N=void 0})):(e.__h.forEach(j),e.__h.forEach(Q),e.__h=[],B=0)),K=v},x.diffed=function(t){ce&&ce(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ne.push(e)!==1&&ie===x.requestAnimationFrame||((ie=x.requestAnimationFrame)||Fe)(Ue)),e.__H.__.forEach(function(_){_.u&&(_.__H=_.u),_.u=void 0})),K=v=null},x.__c=function(t,e){e.some(function(_){try{_.__h.forEach(j),_.__h=_.__h.filter(function(r){return!r.__||Q(r)})}catch(r){e.some(function(o){o.__h&&(o.__h=[])}),e=[],x.__e(r,_.__v)}}),ae&&ae(t,e)},x.unmount=function(t){ue&&ue(t);var e,_=t.__c;_&&_.__H&&(_.__H.__.forEach(function(r){try{j(r)}catch(o){e=o}}),_.__H=void 0,e&&x.__e(e,_.__v))};var he=typeof requestAnimationFrame=="function";function Fe(t){var e,_=function(){clearTimeout(r),he&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(_,35);he&&(e=requestAnimationFrame(_))}function j(t){var e=v,_=t.__c;typeof _=="function"&&(t.__c=void 0,_()),v=e}function Q(t){var e=v;t.__c=t.__(),v=e}function We(t,e){return!t||t.length!==e.length||e.some(function(_,r){return _!==t[r]})}function Pe(t,e){return typeof e=="function"?e(t):e}function je(t){const e=[],_=t.split(/\n\s*\n/);for(const r of _){const o=r.trim().split(/\r?\n/);if(o.length>=3){const n=o[0],[l,s]=o[1].split(" --> "),u=o.slice(2).join(" ");e.push({index:n,start:l,end:s,text:u})}}return e}function Re(){const[t,e]=O([]),[_,r]=O(null),[o,n]=O({}),[l,s]=O({}),[u,c]=O(null);pe(()=>{fetch("/test.srt").then(a=>a.ok?a.text():null).then(a=>{a&&e(je(a))})},[]),pe(()=>{fetch("/prompt.json").then(a=>a.json()).then(r).catch(console.error)},[]);function p(a){return t.slice(Math.max(0,a-10),a).concat(t.slice(a+1,a+11)).map(y=>y.text)}async function i(a){var S,C,N;if(!_)return;let f=localStorage.getItem("openai_api_key");if(!f)if(f=window.prompt("Enter your OpenAI API key:")||"",f)localStorage.setItem("openai_api_key",f);else return;c(a);const y=t[a],w=t[a+1]||null,g=p(a),h={prompt:_.prompt.replace(/<language>/gi,_.language),targetlanguage:_.language,summary:_.summary,srtEntry:y.text,nextSrtEntry:w?w.text:null,context:g},T='You are a translation assistant. Respond ONLY with a JSON object in this format: {"translation": string, "mergedWithNextEntry": bool}.';try{let $=((N=(C=(S=(await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:T},{role:"user",content:JSON.stringify(h)}],temperature:.2})})).json()).choices)==null?void 0:S[0])==null?void 0:C.message)==null?void 0:N.content)||"",P;try{P=JSON.parse($)}catch{const k=$.match(/\{[\s\S]*\}/);P=k?JSON.parse(k[0]):{translation:"Error: Invalid response",mergedWithNextEntry:!1}}n(k=>({...k,[a]:P.translation})),P.mergedWithNextEntry&&s(k=>({...k,[a+1]:!0}))}catch{n(H=>({...H,[a]:"Translation error"}))}finally{c(null)}}return b("div",{class:"p-4 max-w-4xl mx-auto",children:b("div",{class:"mb-4",children:[b("h2",{class:"font-semibold",children:"SRT Table:"}),b("div",{class:"overflow-auto max-h-96 border rounded",children:b("table",{class:"min-w-full text-xs",children:[b("thead",{class:"bg-gray-100 sticky top-0",children:b("tr",{children:[b("th",{class:"px-2 py-1 border-b text-left",children:"#"}),b("th",{class:"px-2 py-1 border-b text-left",children:"Timestamps"}),b("th",{class:"px-2 py-1 border-b text-left",children:"Content"}),b("th",{class:"px-2 py-1 border-b text-left",children:"Translated Content"})]})}),b("tbody",{children:t.map((a,f)=>b("tr",{class:f%2===0?"bg-white":"bg-gray-50",style:{cursor:"pointer"},onClick:()=>i(f),children:[b("td",{class:"px-2 py-1 border-b align-top",children:a.index}),b("td",{class:"px-2 py-1 border-b align-top whitespace-nowrap",children:[a.start," ",b("br",{}),"→ ",a.end]}),b("td",{class:"px-2 py-1 border-b align-top",children:a.text}),b("td",{class:"px-2 py-1 border-b align-top text-blue-700 italic",children:u===f?"Translating...":l[f]?b("span",{class:"text-gray-400",children:"(merged with previous)"}):o[f]||""})]},f))})]})})]})})}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("app");t&&Oe(b(Re,{}),t)});
